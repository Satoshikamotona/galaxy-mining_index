 <!DOCTYPE html>
<html lang="en">


<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>galaxyMining - Inscription</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.4.0/dist/web3.min.js"></script>

</head>

<body>
    <header>


<button id="connectWalletButton">Connect Wallet</button>
<div id="connectcontract">Not connected to smart contract</div>

        <div class="logo-container">
            <img src="im.png" alt="Logo" class="logo">
            <h1 class="site-title">GalaxyMining</h1>
            <img src="17.png" alt="Binance Smart Chain Logo" class="bnb-logo">
        </div>
        <h2>Welcome to <span class="highlight-text">galaxy mining</span></h2>
    
            
         
        </div>
    </header>

    <main>
        <section class="container text-center">
            <div class="registration-container">
                <p>Connect your wallet to register</p>
                <!-- Registration Form -->
                <form id="registrationForm">
                    <label for="parrain">Parrain's Address:</label>
                    <input type="text" id="parrain" name="parrain" placeholder="Enter your sponsor's address">
                    <input type="submit" value="Register">
                </form>
                
                
                <p>Registration requires 0.01 BNB</p>
            </div>
            <p>If you are already registered, <a href="login.html">click here</a> to log in.</p>
        </section>

        <section class="text-center">
            <h2>Contact</h2>
            <p>Contact us at email@example.com.</p>
        </section>
    </main>

    <footer class="text-center">
        <p>&copy; galaxyMining</p>
    </footer>

    <script src="web3integration.js"></script>

    <script>
        document.getElementById('connectWalletButton').addEventListener('click', event => {
            // Vérifie si l'objet Ethereum est disponible dans window
            if (window.ethereum) {
                ethereum.request({ method: 'eth_requestAccounts' }).then(accounts => { 
                    const account = accounts[0];
                    console.log("Compte connecté :", account);
                }).catch(error => {
                    console.error("Erreur lors de la connexion au portefeuille :", error);
                });
            } else {
                console.log("Navigateur Ethereum non détecté. Essayez d'installer MetaMask!");
            }
        });

        let account
        const connectcontract = async() => {
            const ABI = [{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"referrers","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"referrer","type":"address"}],"name":"register","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"registrationFees","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"}];
            const Address = "0xaC048568bB07cA5C9BC7373c5c9227c3D4492343";
            window.web3 = new Web3(window.ethereum);

            try {
                await window.ethereum.request({ method: 'eth_requestAccounts' });
                account = (await web3.eth.getAccounts())[0];

                window.contract = new web3.eth.Contract(ABI, Address);
                document.getElementById("connectcontract").innerHTML = "Connected to smart contract";
            } catch (error) {
                console.error("Error connecting to contract: ", error);
            }
        };

        document.getElementById("connectWalletButton").addEventListener('click', connectcontract);


        document.addEventListener('DOMContentLoaded', function () {
    var registrationForm = document.getElementById('registrationForm');
    if (registrationForm) {
        registrationForm.addEventListener('submit', async function (e) {
            e.preventDefault();
            const parrainAddress = document.getElementById('parrain').value;

            if (!parrainAddress) {
                alert("Please enter the upline address.");
                return;
            }

            if (!window.contract) {
                alert("You are not connected to the smart contract.");
                return;
            }

             try {
                const accounts = await web3.eth.getAccounts();
                const userAddress = accounts[0];
                const registrationFee = web3.utils.toWei('0.0004', 'ether');

               
                const response = await window.contract.methods.register(parrainAddress).send({ from: userAddress, value: registrationFee });
                console.log("successful registration:", response);
            } catch (error) {
                console.error("Error during registration:", error);
                alert("An error occurred during registration.");
            }
        });
    }
});

    </script>
    
    
</body>

</html>

 <!DOCTYPE html>
<html lang="en">


<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>galaxyMining - registration</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.4.0/dist/web3.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>


</head>

<body>
    <header>
        
        <button id="connectWalletButton" class="connect-btn">Connect Wallet</button>
        <div id="connectcontract" class="contract-status">
            <span id="contractIcon"></span> 
            <span id="contractStatus">Not connected to smart contract</span>
        </div>
        

        <div class="logo-container">
            <h1 class="site-title">GalaxyMining</h1>
            <img src="17.png" alt="Binance Smart Chain Logo" class="bnb-logo">
        </div>
        <h2>Welcome to <span class="highlight-text">galaxy mining</span></h2>
    
            
         
        </div>
    </header>

    <main>
        <section class="container text-center">
            <div class="registration-container">
                <h4>Connect your wallet to register</h4>
                <!-- Registration Form -->
                <form id="registrationForm">
                    <label for="parrain">Parrain's Address:</label>
                    <input type="text" id="parrain" name="parrain" placeholder="Enter your sponsor's address">
                    <input type="submit" value="Register">
                </form>
                
                
                <p>Registration requires 0.0004 BNB</p>
            </div>
            <p>If you are already registered, <a href="index.html">click here</a> to log in.</p>
        </section>

        <section class="text-center">
            <h2>Contact</h2>
            <p>Contact us at email@example.com.</p>
        </section>
    </main>

    <footer class="text-center">
        <p>&copy; galaxyMining</p>
    </footer>


    <script>


var galaxyMining = {
    account: null,
    contract: null,
    userAccount: null,

    connectContract: async function() {
          const ABI =[{"inputs":[{"internalType":"address","name":"admin","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"A","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"Admin","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"UserToUpgrade","type":"address"},{"internalType":"uint256","name":"LevelToBuy","type":"uint256"}],"name":"BuyLevel","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"address","name":"UserToCheck","type":"address"}],"name":"CheckUserLastUpdate","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"Claim_DIV","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"G56Matrix","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"USER","type":"address"}],"name":"GetDivPerSec","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address payable","name":"_To","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"HoldFunds","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address payable","name":"_To","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"HoldFundsbyAdmin","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"LastUpdate","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"Level10Income","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"NumberOfUsers","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"newRate","type":"uint256"}],"name":"SetRate","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"TotalIncome","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"UplineEarnings","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"UserID","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"Users","outputs":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"address","name":"userAddress","type":"address"},{"internalType":"address","name":"referrer","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"_owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"availableDiv","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"calculateDiv","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"checkUpdate","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"directIncome","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"directIncomefrom10","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"directPartnersCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"divPerSecInEther","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"freeIncome","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getDirectPartners","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getLastLevelBuyer","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getLastRegistration","outputs":[{"internalType":"uint256","name":"userID","type":"uint256"},{"internalType":"address","name":"referrer","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getTotalTeamSize","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"},{"internalType":"uint256","name":"level","type":"uint256"}],"name":"hasLevel","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_referrer","type":"address"},{"internalType":"uint256","name":"_requiredLevel","type":"uint256"}],"name":"hasRequiredLevel","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"idToAddress","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"isAdmin","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"isOwner","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"isRegistered","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"l","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"lastDivClaimed","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"lastLevelBuyer","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"lastUserID","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"levelPrices","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"randomUser","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"referrers","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"UserToRegister","type":"address"},{"internalType":"address","name":"referrerAddress","type":"address"}],"name":"registerUser","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"registrationFees","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newAdmin","type":"address"}],"name":"setAdmin","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"setOwner","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"newfees","type":"uint256"}],"name":"setholdingFees","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"totalDivClaimed","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalInevest","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalLevels","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"userPartners","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"stateMutability":"payable","type":"receive"}];
          const Address = "0x93d05AA1Df1a9635b6E8C4c97c848b2b77A08743";

          try {
            window.web3 = new Web3(window.ethereum);
            await window.ethereum.request({ method: 'eth_requestAccounts' });
            this.account = (await web3.eth.getAccounts())[0];
            this.contract = new web3.eth.Contract(ABI, Address);
            console.log("Connected to smart contract");
        } catch (error) {
            console.error("Error connecting to contract: ", error);
        }
    },



    registerUser: async function(referrerAddress) {
        if (!this.contract) {
            alert("You are not connected to the smart contract.");
            return;
        }

        try {
            const userAddress = this.account; 
            const registrationFee = web3.utils.toWei('0.01', 'ether');
            const userBalance = await web3.eth.getBalance(userAddress);

            if (BigInt(userBalance) >= BigInt(registrationFee)) {
                const response = await this.contract.methods.registerUser(userAddress, referrerAddress).send({ from: userAddress, value: registrationFee });
                console.log("Registration successful:", response);
                alert("Registration successful!");
                window.location.href = 'index.html';
            } else {
                alert("Your balance is insufficient to cover the registration fee.");
            }
        } catch (error) {
            console.error("Error during registration:", error);
            alert("An error occurred during registration.");
        }
    
    },
    
    checkRegistrationStatus: async function() {
        if (window.ethereum && this.contract) {
            try {
                const accounts = await web3.eth.getAccounts();
                if (accounts.length === 0) {
                    console.log("No Ethereum account found.");
                    return;
                }

                this.userAccount = accounts[0];
                const isRegistered = await this.contract.methods.isRegistered(this.userAccount).call();

                if (isRegistered) {
                    alert("You are already registered. Now you will automatically be redirected to your account.");
                    window.location.href = 'dashboard.html';
                }
            } catch (error) {
                console.error("Error checking registration status:", error);
            }
        } else {
            console.log("Ethereum environment or contract not found.");
        }
    },

    connectWallet: async function() {
    if (window.ethereum) {
        try {
            const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
            this.userAccount = accounts[0];
            this.updateWalletButton();

            // Mettre à jour le texte dans #contractStatus
            const contractStatus = document.getElementById("contractStatus");
            if (this.contract) {
                contractStatus.textContent = "Connected to smart contract";
            } else {
                contractStatus.textContent = "Not connected to smart contract";
            }

            // Autres actions après la connexion au portefeuille...
        } catch (error) {
            console.error("Error connecting to wallet:", error);
        }
    } else {
        console.log("Ethereum environment not detected. Please install MetaMask!");

        // Mettre à jour le texte dans #contractStatus
        const contractStatus = document.getElementById("contractStatus");
        contractStatus.textContent = "Ethereum environment not detected. Please install MetaMask!";
    }
},



    updateWalletButton:async function() {
        const connectButton = document.getElementById('connectWalletButton');
        if (this.userAccount) {
            const truncatedAddress = this.userAccount.substr(0, 6) + '...' + this.userAccount.substr(-4);
            connectButton.textContent = truncatedAddress;
            // Ajoutez des styles supplémentaires si nécessaire
        } else {
            connectButton.textContent = "Connect Wallet";
        }
    },




init: async function() {
 await this.connectContract();
 await this.checkRegistrationStatus();
 await this.connectWallet();
 await this.updateWalletButton();



const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
if (accounts.length === 0) {
   console.error("No Ethereum accounts found.");
   return;
}

this.userAccount = accounts[0];
const truncatedAddress = this.userAccount.substring(0, 6) + '...' + this.userAccount.substring(this.userAccount.length - 4);
$('.connectWalletButton').text(truncatedAddress);

const buttons = document.querySelectorAll('.buy-level-button');

buttons.forEach(button => {
  button.addEventListener('click', (event) => this.buyLevel(event));
});
}
};

$(document).ready(async () => {
    try {
        await galaxyMining.init();

        $('#registrationForm').submit(async function(e) {
            e.preventDefault(); // Empêche le comportement par défaut de soumission du formulaire

            const referrerAddress = $('#parrain').val(); // Récupère l'adresse du parrain
            const userBalance = await web3.eth.getBalance(galaxyMining.account); // Obtient le solde de l'utilisateur

            if (!galaxyMining.contract) {
                alert("You are not connected to the smart contract.");
                return;
            }

            const registrationFee = web3.utils.toWei('0.01', 'ether');
            if (BigInt(userBalance) < BigInt(registrationFee)) {
                alert("Your balance is insufficient to cover the registration fee.");
                return;
            }

            if (referrerAddress) {
                // Appelle registerUser avec l'adresse du parrain
                await galaxyMining.registerUser(referrerAddress);
            } else {
                alert("Please enter the parrain's address.");
            }
        });

    } catch (error) {
        console.error("Error in Ethereum interaction:", error);
    }
});


    </script>
    
    
</body>

</html>

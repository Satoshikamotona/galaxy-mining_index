

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<link rel="stylesheet" href="preview.css">

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>C56 Preview</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/web3@1.3.0/dist/web3.min.js"></script>
</head>

<body>
  <div class="dashboard-header">
    <img src="17.png" alt="Binance Logo">

    <span class="wallet-address">0x00...000</span>
      </div>
      <div class="MATRIX">
        <div class="G56">
            <h2>G56 MATRIX</h2>
        </div>
    
        <div class="main-container">
            <div class="card" id="lvl1">
                <div class="badge-container">
                    <h4>Lvl 1</h4>
                    <h5>0.01 BNB</h5>

                    <div class="badges">
                        <img src="Hackathon (9).png" alt="Buy A level" class="buy-level-button" data-level="1" data-amount="0.1" onclick="BuyAlevel()">
                

                  </div>
                </div>
            </div>
    
            <div class="card" id="lvl2">
                <div class="badge-container">
                    <h4>Lvl 2</h4>
                    <h5>0.01 BNB</h5>

                    <div class="badges">
                      <img src="Hackathon (9).png" alt="Buy A level" class="buy-level-button" data-level="2" data-amount="0.1" onclick="BuyAlevel()">

                

                  </div>
                </div>
            </div>
       
            <div class="card" id="lvl3">
              <div class="badge-container">
                  <h4>Lvl 3</h4>
                  <h5>0.01 BNB</h5>

                  <div class="badges">
                    <img src="Hackathon (9).png" alt="Buy A level" class="buy-level-button" data-level="3" data-amount="0.1" onclick="BuyAlevel()">

                

                </div>
              </div>
          </div>
     
          <div class="card" id="lvl4">
            <div class="badge-container">
                <h4>Lvl 4</h4>
                <h5>0.01 BNB</h5>


                <div class="badges">
                  <img src="Hackathon (9).png" alt="Buy A level" class="buy-level-button" data-level="4" data-amount="0.1" onclick="BuyAlevel()">

               

              </div>
            </div>
        </div>
   
  
        <div class="card" id="lvl5">
          <div class="badge-container">
              <h4>Lvl 5</h4>
              <h5>0.01 BNB</h5>

              <div class="badges">
                <img src="Hackathon (9).png" alt="Buy A level" class="buy-level-button" data-level="5" data-amount="0.1" onclick="BuyAlevel()">


            </div>
          </div>
      </div>
 
     
      <div class="card" id="lvl6">
        <div class="badge-container">
            <h4>Lvl 6</h4>
            <h5>0.01 BNB</h5>

            <div class="badges">
              <img src="Hackathon (9).png" alt="Buy A level" class="buy-level-button" data-level="6" data-amount="0.1" onclick="BuyAlevel()">

         

          </div>
        </div>
    </div>

    <div class="card" id="lvl7">
      <div class="badge-container">
          <h4>Lvl 7</h4>
          <h5>0.01 BNB</h5>

          <div class="badges">
            <img src="Hackathon (9).png" alt="Buy A level" class="buy-level-button" data-level="7" data-amount="0.1" onclick="BuyAlevel()">

        

        </div>
      </div>
  </div>

  <div class="card" id="lvl8">
    <div class="badge-container">
        <h4>Lvl 8</h4>
        <h5>0.01 BNB</h5>

        <div class="badges">
          <img src="Hackathon (9).png" alt="Buy A level" class="buy-level-button" data-level="8" data-amount="0.1" onclick="BuyAlevel()">


      </div>
    </div>
</div>

<div class="card" id="lvl9">
  <div class="badge-container">
      <h4>Lvl 9 </h4>
      <h5>0.01 BNB</h5>
      <div class="badges">
        <img src="Hackathon (9).png" alt="Buy A level" class="buy-level-button" data-level="9" data-amount="0.1" onclick="BuyAlevel()">

    
    </div>
  </div>
</div>

<div class="card" id="lvl10">
  <div class="badge-container">
      <h4>Lvl 10</h4>
      <h5>0.01 BNB</h5>

      <div class="badges">
        <img src="Hackathon (9).png" alt="Buy A level" class="buy-level-button" data-level="10" data-amount="0.1" onclick="BuyAlevel()">

  

    </div>
  </div>
</div>

                                              </div>
                                            </div>
                                          </div>
</div>
</body>
<footer class="text-center">
    <p>&copy; galaxyMining</p>
</footer>


<script>

 var galaxyMining = {
    account: null,
    contract: null,
    userAccount: null,

    connectContract: async function() {
          const ABI =[{"inputs":[{"internalType":"address","name":"admin","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"A","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"Admin","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"UserToUpgrade","type":"address"},{"internalType":"uint256","name":"LevelToBuy","type":"uint256"}],"name":"BuyLevel","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"address","name":"UserToCheck","type":"address"}],"name":"CheckUserLastUpdate","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"Claim_DIV","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"G56Matrix","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"USER","type":"address"}],"name":"GetDivPerSec","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address payable","name":"_To","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"HoldFunds","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address payable","name":"_To","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"HoldFundsbyAdmin","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"LastUpdate","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"Level10Income","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"NumberOfUsers","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"newRate","type":"uint256"}],"name":"SetRate","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"TotalIncome","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"UplineEarnings","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"UserID","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"Users","outputs":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"address","name":"userAddress","type":"address"},{"internalType":"address","name":"referrer","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"_owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"availableDiv","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"calculateDiv","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"checkUpdate","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"directIncome","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"directIncomefrom10","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"directPartnersCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"divPerSecInEther","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"freeIncome","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getDirectPartners","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getLastLevelBuyer","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getLastRegistration","outputs":[{"internalType":"uint256","name":"userID","type":"uint256"},{"internalType":"address","name":"referrer","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getTotalTeamSize","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"},{"internalType":"uint256","name":"level","type":"uint256"}],"name":"hasLevel","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_referrer","type":"address"},{"internalType":"uint256","name":"_requiredLevel","type":"uint256"}],"name":"hasRequiredLevel","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"idToAddress","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"isAdmin","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"isOwner","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"isRegistered","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"l","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"lastDivClaimed","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"lastLevelBuyer","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"lastUserID","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"levelPrices","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"randomUser","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"referrers","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"UserToRegister","type":"address"},{"internalType":"address","name":"referrerAddress","type":"address"}],"name":"registerUser","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"registrationFees","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newAdmin","type":"address"}],"name":"setAdmin","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"setOwner","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"newfees","type":"uint256"}],"name":"setholdingFees","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"totalDivClaimed","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalInevest","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalLevels","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"userPartners","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"stateMutability":"payable","type":"receive"}];
          const Address = "0x93d05AA1Df1a9635b6E8C4c97c848b2b77A08743";
        try {
            window.web3 = new Web3(window.ethereum);
            await window.ethereum.request({ method: 'eth_requestAccounts' });
            this.account = (await web3.eth.getAccounts())[0];
            this.contract = new web3.eth.Contract(ABI, Address);
            console.log("Connected to smart contract");
        } catch (error) {
            console.error("Error connecting to contract: ", error);
        }
    },

    buyLevel: async function(event) {
    const button = event.target.closest('.buy-level-button');
    const level = button.getAttribute('data-level');
    let amount = button.getAttribute('data-amount');
    const userAddress = this.userAccount;

    if (!amount) {
        console.error('Amount is null, check data-amount attribute');
        return;
    }

    try {
        const priceWei = web3.utils.toWei(amount, 'ether');
        const userBalanceWei = await web3.eth.getBalance(userAddress);
        
        const receipt = await web3.eth.getTransactionReceipt(transaction.transactionHash);

         if (receipt.status) {
          console.log("Level buy successful:", transaction);
           alert("Level buy successful!");
           window.location.reload();
           
        } else {
            // L'utilisateur n'a pas suffisamment de fonds
            console.log("Your balance is less than the price of the level.");
            alert("Your balance is less than the price of the level.");
        }
    } catch (error) {
        console.error('Transaction failed:', error);
    }
},




    getUserWalletAddress: async function() {
        if (window.ethereum) {
            try {
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                this.userAccount = accounts[0];
                const truncatedAddress = this.userAccount.substring(0, 6) + '...' + this.userAccount.substring(this.userAccount.length - 4);
                $('.wallet-address').text(truncatedAddress);
            } catch (error) {
                console.error("An error occurred connecting to Ethereum:", error);
            }
        } else {
            console.error("Ethereum object not found. You need to install MetaMask!");
        }
    },
  
    getUserIdByAddress: async function(userAddress) {
        const numberOfUsers = await this.contract.methods.NumberOfUsers().call();
        console.log("Nombre total d'utilisateurs:", numberOfUsers);

        for (let userId = 1; userId <= numberOfUsers; userId++) {
            try {
                const address = await this.contract.methods.idToAddress(userId).call();
                console.log("Vérification de l'adresse pour l'ID", userId, ":", address);
                if (address.toLowerCase() === userAddress.toLowerCase()) {
                    console.log("ID trouvé:", userId);
                    return userId;
                }
            } catch (error) {
                console.error("Erreur lors de la récupération de l'adresse pour l'ID", userId, ":", error);
            }
        }

        console.log("Aucun ID trouvé pour l'adresse:", userAddress);
        return null;
    },
    updateLevelsDisplay: async function() {
    const userAddress = this.userAccount;
    const activeLevels = await this.contract.methods.G56Matrix(userAddress).call();

    for (let i = 1; i <= 10; i++) {
        const levelDiv = document.getElementById(`lvl${i}`);
        const badgesDiv = levelDiv.querySelector('.badges');
        const buyButton = levelDiv.querySelector('.buy-level-button');
        const levelPrice = levelDiv.querySelector('h5'); // Sélectionner l'élément h5


        badgesDiv.innerHTML = ''; // Nettoyer les badges précédents ou le bouton "Buy"

        if (i <= activeLevels) {
            // Niveau actif, afficher trois badges
            for (let j = 0; j < 3; j++) { // Toujours créer trois badges
                const badge = document.createElement('div');
                badge.className = 'badge';
                badgesDiv.appendChild(badge); // Ajouter le badge au conteneur
            }
            buyButton.style.display = 'none'; // Cacher le bouton "Buy"
            levelPrice.style.display = 'none'; // Cacher le prix du niveau (h5)

            
        } else {
            // Niveau inactif, afficher le bouton "Buy"
            badgesDiv.appendChild(buyButton); // Ajouter le bouton "Buy" au conteneur
            buyButton.style.display = 'block';
        }
    }
},

updateBadgesDisplay: async function() {
    const activeLevels = await this.contract.methods.G56Matrix(this.userAccount).call();
    const partners = await this.getUserPartners();

    for (let i = 1; i <= activeLevels; i++) {
        const levelDiv = document.getElementById(`lvl${i}`);
        const badgesDiv = levelDiv.querySelector('.badges');
        badgesDiv.innerHTML = ''; // Nettoyer les badges précédents
        let activeBadgesCount = 0;

        // Parcourir chaque partenaire et créer des badges actifs si le niveau du partenaire est suffisant
        for (const partner of partners) {
            // S'arrêter si on a déjà 3 badges actifs
            if (activeBadgesCount >= 3) {
                break;
            }

            const partnerLevel = await this.contract.methods.G56Matrix(partner).call();
            if (partnerLevel >= i) {
                const badge = document.createElement('div');
                badge.className = 'badge badge-active'; // Classe pour un badge actif
                badgesDiv.appendChild(badge);
                activeBadgesCount++;
            }
        }

        // Remplir les badges restants avec des badges inactifs jusqu'à avoir 3 badges au total
        while (badgesDiv.children.length < 3) {
            const badge = document.createElement('div');
            badge.className = 'badge';
            badgesDiv.appendChild(badge);
        }
    }
},




getUserPartners: async function() {
    if (!this.userAccount) {
        console.error("User account is undefined.");
        return;
    }

    try {
        const partners = await this.contract.methods.getDirectPartners(this.userAccount).call();
        console.log("Partenaires directs :", partners);
        return partners;
    } catch (error) {
        console.error("Erreur lors de la récupération des partenaires directs:", error);
    }
},

 
     init: async function() {

          await this.connectContract();
          await this.getUserWalletAddress(); 
          await this.updateLevelsDisplay();
          await this.updateBadgesDisplay();
          await this.getUserPartners();
       
         const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
         if (accounts.length === 0) {
             console.error("No Ethereum accounts found.");
             return;
         }
 
         this.userAccount = accounts[0];
         const truncatedAddress = this.userAccount.substring(0, 6) + '...' + this.userAccount.substring(this.userAccount.length - 4);
         $('.wallet-address').text(truncatedAddress);
 
         const buttons = document.querySelectorAll('.buy-level-button');

        buttons.forEach(button => {
            button.addEventListener('click', (event) => this.buyLevel(event));
        });
    }
};
     
         $(document).ready(async () => {
    try {
        await galaxyMining.init();
    } catch (error) {
        console.error("Error in Ethereum interaction:", error);
    }
});
  

 
 </script>
</html>